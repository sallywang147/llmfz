 #include "flb_fuzz_header.h"
#include <fluent-bit/flb_info.h>
#include <fluent-bit/flb_output.h>
#include <fluent-bit/flb_pack.h>
#include <fluent-bit/flb_time.h>
#include <fluent-bit/flb_unescape.h>

/* A sample of configurations */
char conf_file[] = "# Output: vivo\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9200\n"
                   "    Index test\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "\n"
                   "# Output: vivo2\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo2\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9201\n"
                   "    Index test2\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "\n"
                   "\n"
                   "# Output: vivo3\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo3\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9202\n"
                   "    Index test3\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "\n"
                   "\n"
                   "# Output: vivo4\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo4\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9203\n"
                   "    Index test4\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "\n"
                   "\n"
                   "# Output: vivo5\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo5\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9204\n"
                   "    Index test5\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify On\n"
                   "\n"
                   "\n"
                   "# Output: vivo6\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo6\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9205\n"
                   "    Index test6\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "\n"
                   "\n"
                   "# Output: vivo7\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo7\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9206\n"
                   "    Index test7\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_1\n"
                   "\n"
                   "\n"
                   "# Output: vivo8\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo8\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9207\n"
                   "    Index test8\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_2\n"
                   "\n"
                   "\n"
                   "# Output: vivo9\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo9\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9208\n"
                   "    Index test9\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_3\n"
                   "\n"
                   "\n"
                   "# Output: vivo10\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo10\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9209\n"
                   "    Index test10\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1\n"
                   "\n"
                   "\n"
                   "# Output: vivo11\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo11\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9210\n"
                   "    Index test11\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSLv3\n"
                   "\n"
                   "\n"
                   "# Output: vivo12\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo12\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9211\n"
                   "    Index test12\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSLv2\n"
                   "\n"
                   "\n"
                   "# Output: vivo13\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo13\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9212\n"
                   "    Index test13\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLS\n"
                   "\n"
                   "\n"
                   "# Output: vivo14\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo14\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9213\n"
                   "    Index test14\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSL\n"
                   "\n"
                   "\n"
                   "# Output: vivo15\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo15\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9214\n"
                   "    Index test15\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSLv23\n"
                   "\n"
                   "\n"
                   "# Output: vivo16\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo16\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9215\n"
                   "    Index test16\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_2_TLSv1_1_TLSv1\n"
                   "\n"
                   "\n"
                   "# Output: vivo17\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo17\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9216\n"
                   "    Index test17\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_3_TLSv1_2_TLSv1_1\n"
                   "\n"
                   "\n"
                   "# Output: vivo18\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo18\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9217\n"
                   "    Index test18\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_2_TLSv1_1\n"
                   "\n"
                   "\n"
                   "# Output: vivo19\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo19\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9218\n"
                   "    Index test19\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_1_TLSv1\n"
                   "\n"
                   "\n"
                   "# Output: vivo20\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo20\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9219\n"
                   "    Index test20\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1\n"
                   "\n"
                   "\n"
                   "# Output: vivo21\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo21\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9220\n"
                   "    Index test21\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSLv3\n"
                   "\n"
                   "\n"
                   "# Output: vivo22\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo22\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9221\n"
                   "    Index test22\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSLv2\n"
                   "\n"
                   "\n"
                   "# Output: vivo23\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo23\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9222\n"
                   "    Index test23\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLS\n"
                   "\n"
                   "\n"
                   "# Output: vivo24\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo24\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9223\n"
                   "    Index test24\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSL\n"
                   "\n"
                   "\n"
                   "# Output: vivo25\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo25\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9224\n"
                   "    Index test25\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion SSLv23\n"
                   "\n"
                   "\n"
                   "# Output: vivo26\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo26\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9225\n"
                   "    Index test26\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_2_TLSv1_1_TLSv1\n"
                   "\n"
                   "\n"
                   "# Output: vivo27\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo27\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9226\n"
                   "    Index test27\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_3_TLSv1_2_TLSv1_1\n"
                   "\n"
                   "\n"
                   "# Output: vivo28\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo28\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9227\n"
                   "    Index test28\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_2_TLSv1_1\n"
                   "\n"
                   "\n"
                   "# Output: vivo29\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo29\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9228\n"
                   "    Index test29\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1_1_TLSv1\n"
                   "\n"
                   "\n"
                   "# Output: vivo30\n"
                   "# ============\n"
                   "#\n"
                   "[OUTPUT]\n"
                   "    Name vivo30\n"
                   "    Match *.*\n"
                   "    Host localhost\n"
                   "    Port 9229\n"
                   "    Index test30\n"
                   "    Type elasticsearch\n"
                   "    Flush 1\n"
                   "    User user\n"
                   "    Pass password\n"
                   "    CAFile /etc/pki/tls/certs/ca-bundle.crt\n"
                   "    SSLVerify Off\n"
                   "    SSLVersion TLSv1\n"
                   "\n"
                   "\n";

int LLVMFuzzerTestOneInput(const uint8_t *data, size_t size) {
  /* Set fuzzer-malloc chance of failure */
  flb_malloc_p = 0;
  flb_malloc_mod = 25000;

  /* Limit the size of the config files to 32KB. */
  if (size > 32768) {
    return 0;
  }

  /* Write the config file to a location we know OSS-Fuzz has */
  char filename[256];
  sprintf(filename, "/tmp/libfuzzer.%d", getpid());
  FILE *fp = fopen(filename, "wb");
  if (!fp) {
    return 0;
  }
  fwrite(conf_file, strlen(conf_file), 1, fp);
  fclose(fp);

  /* Now parse random data based on the config files */
  struct flb_config *config = NULL;
  config = flb_config_init();
  int ret = flb_parser_conf_file(filename, config);
  if (ret == 0) {
    struct mk_list *head = NULL;
    mk_list_foreach(head, &config->outputs) {
      struct flb_output_instance *ins = NULL;
      ins = mk_list_entry(head, struct flb_output_instance, _head);
      cb_vivo_init(ins, config, NULL);
    }
  }
  flb_config_exit(config);

  /* clean up the file */
  unlink(filename);

  return 0;
}
</solution>